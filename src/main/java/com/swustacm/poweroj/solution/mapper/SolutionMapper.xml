<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.swustacm.poweroj.solution.mapper.SolutionMapper">

    <!-- 通用查询映射结果 -->
    <resultMap id="BaseResultMap" type="com.swustacm.poweroj.solution.entity.Solution">
        <id column="sid" property="sid" />
        <result column="uid" property="uid" />
        <result column="pid" property="pid" />
        <result column="cid" property="cid" />
        <result column="num" property="num" />
        <result column="time" property="time" />
        <result column="memory" property="memory" />
        <result column="result" property="result" />
        <result column="language" property="language" />
        <result column="ctime" property="ctime" />
        <result column="mtime" property="mtime" />
        <result column="test" property="test" />
        <result column="wrong" property="wrong" />
        <result column="error" property="error" />
        <result column="source" property="source" />
        <result column="codeLen" property="codeLen" />
        <result column="systemError" property="systemError" />
        <result column="status" property="status" />
    </resultMap>
    <select id="solutionPage" resultType="com.swustacm.poweroj.solution.entity.Solution">
SELECT
	sid,
	s.uid as uid,
	pid,
	result,
	time,
	memory,
	s.LANGUAGE,
	codeLen,
	FROM_UNIXTIME( s.ctime, '%Y-%m-%d %H:%i:%s' ) AS stime,
	u.NAME,
	u.nick as nick
FROM
	solution s
	INNER JOIN USER u ON u.uid = s.uid
<where>
    <if test="param.language != null">
        s.LANGUAGE = #{param.language}
    </if>
    <if test="param.userName != null">
      and  u.NAME = #{param.userName}
    </if>
    <if test="param.result != null">
       and  result = #{param.result}
    </if>
    <if test="param.pid != null">
        and  pid = #{param.pid}
    </if>
</where>
ORDER BY
	s.ctime DESC
    </select>
    <select id="findSolution" resultType="com.swustacm.poweroj.solution.entity.Solution">
        SELECT * FROM solution WHERE sid=#{sid} AND status=1 LIMIT 1
    </select>
    <select id="getProblemTitle" resultType="java.lang.String">
        SELECT title FROM contest_problem WHERE cid=#{cid} AND num=#{num} LIMIT 1
    </select>
    <select id="getSolutionPro" resultType="com.swustacm.poweroj.solution.entity.Solution">
        SELECT s.sid,u.name as userName, s.time,s.memory,s.language,s.codeLen, FROM_UNIXTIME(s.ctime,'%Y-%m-%d %H:%i:%s') as stime
         FROM  solution as s left join user as u on s.uid = u.uid
         Where s.pid = #{param2}
        order by s.time ASC
    </select>

</mapper>
